var winupay,horaslimite=.016;function validarrecpas(){val=$("#email").val(),""==val?alert(funcionsi18n.debeponermail):$.ajax({url:"/fnajax/ajxvalidmail.php?email="+val,type:"get",success:function(a){"1"==a?alert(funcionsi18n.noexisteclimail):"2"==a&&0===$("#cliente").length?(mostrar_multiuser(),alert(funcionsi18n.existevarclimail)):(alert(funcionsi18n.recibmailpass),$("#recpas").submit())}})}function valid_frm(a){var e=$("#frmregis");e[0].checkValidity()||$('<input type="submit">').hide().appendTo(e).click().remove(),$.ajax({url:"/fnajax/ajxvalidform.php?opc="+a+"&"+$("#frmregis").serialize(),type:"get",success:function(e){password=$("#password").val(),password2=$("#password2").val(),-1==a&&password!=password2?alert(funcionsi18n.passwordnocoinciden):jQuery.isXMLDoc(e)&&1==e.getElementsByTagName("error")[0].childNodes[0].nodeValue?alert(e.getElementsByTagName("mensaje")[0].childNodes[0].nodeValue):"11"==e?alert(funcionsi18n.sesioncaduc):"13"==e?alert(funcionsi18n.notarjvinc):"12"==e?alert(funcionsi18n.emailnocorrecto):"14"==e?alert(funcionsi18n.emailnocoincide):"15"==e?alert(funcionsi18n.fechanovalida):"10"==e?alert(funcionsi18n.cifnocorrecto):"1"==e?alert(funcionsi18n.yausuarionif1):"3"==e?alert(funcionsi18n.yausuarionif2):"4"==e?alert(funcionsi18n.camposobligatorios):"5"==e?alert(funcionsi18n.aceptarlopd):"6"==e?alert(funcionsi18n.cccnocorrecta):"8"==e?alert(funcionsi18n.captchanocoincide):"16"==e?alert(funcionsi18n.captchaerror):"9"==e?alert(funcionsi18n.ibannocorrecto):"2"==e?(alert(funcionsi18n.graciasymail),$("#frmregis").submit()):(1==a?alert(funcionsi18n.gracias):-1==a&&alert(funcionsi18n.graciasact),$("#frmregis").submit())}})}function validarfrm(a){var e=document.getElementById("g-sitekey");null!=e?grecaptcha.ready((function(){grecaptcha.execute(document.getElementById("g-sitekey").value,{action:"submit"}).then((function(e){document.getElementById("g-recaptcha-response").value=e,valid_frm(a)}))})):valid_frm(a)}function validardatcli(){validarfrm(-1)}function validarregis(){validarfrm(1)}function validaralta(){validarfrm(2)}function valform(a){$.ajax({url:"/fnajax/ajxvalidform.php?"+$(a).serialize(),type:"get",success:function(e){"11"==e?alert(funcionsi18n.sesioncaduc):"12"==e?alert(funcionsi18n.emailnocorrecto):"2"==e?alert(funcionsi18n.captchanocoincide):"16"==e?alert(funcionsi18n.captchaerror):"1"==e?alert(funcionsi18n.camposobligatorios):$(a).submit()}})}function validarform(a){if(a)var e="#"+a+" input",n="#"+a;else e="#formulario input",n="#formulario";var t=!0;if($(e).each((function(a){var e=$(this);if("file"==e.attr("type")){var n=e.val();""!=n&&-1==n.indexOf(".pdf")&&-1==n.indexOf(".jpg")&&-1==n.indexOf(".jpeg")&&-1==n.indexOf(".png")&&-1==n.indexOf(".PDF")&&-1==n.indexOf(".JPG")&&-1==n.indexOf(".JPEG")&&-1==n.indexOf(".PNG")&&(t=!1)}})),0==t)alert(funcionsi18n.formnovalid);else{var i=document.getElementById("g-sitekey");null!=i?grecaptcha.ready((function(){grecaptcha.execute(document.getElementById("g-sitekey").value,{action:"submit"}).then((function(a){document.getElementById("g-recaptcha-response").value=a,valform(n)}))})):valform(n)}}function prevalidarlogin(){return""==document.getElementById("email").value?alert("Debe introducir un email."):""==document.getElementById("password").value?alert("Debe rellenar el campo Password."):(email=document.getElementById("email").value,password=document.getElementById("password").value,$.ajax({url:"/fnajax/ajxnummail.php?email="+email,type:"get",success:function(a){var e=$("#login").serialize();$.ajax({url:"/fnajax/ajxcargarusers.php",type:"post",data:e,success:function(e){"KO"==e?($("#tdmultiuser").html(""),$("#trmultiuser").css("display","none"),alert("Email o Password no correctos.")):a>1?("none"!=document.getElementById("trmultiuser").style.display&&0==document.getElementById("cliente").value&&alert("Debe escoger el usuario con el que accede. Cuando este dentro puede cambiar a los otros"),$("#tdmultiuser").html(e),$("#trmultiuser").css("display","")):($("#tdmultiuser").html(""),$("#trmultiuser").css("display","none"),document.getElementById("login").submit())}})}})),!1}function mostrar_act(){fecha=$("#act_cal").val(),$.ajax({url:"/fnajax/ajxactividades.php?fecha="+fecha,type:"get",success:function(a){$("#actividad").html(a),switched=!1,updateTables()}})}function recalc_act_actsem(a){document.getElementById("actividadactsem").value=a,mostrar_actsem(a,document.getElementById("fechaactsem").value,document.getElementById("salaactsem").value)}function recalc_sal_actsem(a){document.getElementById("salaactsem").value=a,mostrar_actsem(document.getElementById("actividadactsem").value,document.getElementById("fechaactsem").value,a)}function mostrar_actsem(a,e,n){params="",void 0!==e&&(params+="&fecha="+e),void 0!==n&&(params+="&sala="+n),$.ajax({url:"/fnajax/ajxactividadessem.php?val="+a+params,type:"get",success:function(a){$("#lasactividadessem").html(a),switched=!1,updateTables()}})}function cargar_acts(){fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),0==$("#oldres").val()?$.ajax({url:"/fnajax/ajxcargaracts.php?fecha="+fecha+"&tipoact="+tipoact,type:"get",success:function(a){$("#tdtipoactividad").html(a),cargar_prods()}}):mostrar_res()}function cargar_acts_esp(a,e){$("#res_cal").val(a),$.ajax({url:"/fnajax/ajxcargaracts.php?fecha="+a+"&tipoact="+e,type:"get",success:function(a){$("#tdtipoactividad").html(a),cargar_prods()}})}function cargar_prods(){idplanning=$("#tipoactividad").val(),tipocargo=0,$("#tipocargo").val()>=0&&(tipocargo=$("#tipocargo").val()),$("#trfcob").css("display","none"),$("#trprod").css("display","none"),$.ajax({url:"/fnajax/ajxcargarprods.php?idplanning="+idplanning+"&tipocargo="+tipocargo+"&tipo=1",type:"get",success:function(a){""==a?($("#tdproducto").html('<input type="hidden" name="tipocargo" value="0" id="tipocargo"><select name="producto" id="producto" onchange="mostrar_res();"></select>'),$("#trprod").css("display","none"),$("#formacobro").val(0)):(responsefilt=JSON.parse(a),$("#pax").val(responsefilt.pax),$("#tdproducto").html(responsefilt.html),1==$("#accion").val()&&1==responsefilt.extendible?($("#trextend").css("display",""),$("#lim_ext").val(responsefilt.fechaextendible)):($("#trextend").css("display","none"),$("#trextendfin").css("display","none")),1==$("#accion").val()&&($("#producto").val()>0?(cargar_formas_cobro(),$("#trprod").css("display","")):$("#tdformacobro").html(""),2==$("#tipocargo").val()&&$("#producto").val()>0?($("#trfcob").css("display",""),$("#trprod").css("display",""),$("#campocargop").css("display",""),$("#campocargot").css("display","none")):1==$("#tipocargo").val()&&($("#campocargop").css("display","none"),$("#campocargot").css("display",""),$("#trprod").css("display",""))),chgextend()),mostrar_res()}})}function chgacc(a){1==a?($("#tracts").css("display",""),cargar_acts(),$("#trpax").css("display",""),$("#trfcob").css("display","")):a>1&&($("#tdproducto").html('<select name="producto" id="producto" onchange="mostrar_res();"></select>'),$("#tdformacobro").html('<select name="formacobro" id="formacobro" onchange="click_cambiar_fcob()">'),$("#trprod").css("display","none"),$("#trpax").css("display","none"),$("#trfcob").css("display","none"),$("#trextend").css("display","none"),$("#trextendfin").css("display","none")),$("#oldres").val(0),$("#tdcambios").html(""),$("#tracts").css("display",""),mostrar_res()}function chgextend(){$("#extender").val()>0?$("#trextendfin").css("display",""):$("#trextendfin").css("display","none")}function mostrar_res(){fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),$.ajax({url:"/fnajax/ajxreservas.php?tipo=0&fecha="+fecha+"&idplanning="+tipoact,type:"get",success:function(a){$("#reserva").html(a)}})}function click_cambiar_fcob(){var a=$("#formacobro").val();$("#esextendible").val();1==$("#esextendible").val()&&"-10,"==a.substring(0,4)?$("#trextend").css("display",""):($("#trextend").css("display","none"),$("#trextendfin").css("display","none"))}function cargar_formas_cobro(){prodtmp=$("#producto").val(),prodarr=prodtmp.split("."),idprod=prodarr[0],precioxpax=prodarr[1],numpax=$("#pax").val(),$.ajax({url:"/fnajax/ajxcargarfcobros.php?idprod="+idprod+"&numpax="+numpax+"&precioxpax="+precioxpax,type:"get",success:function(a){$("#tdformacobro").html(a),"0.00"==$("#productoprecio").val()?$("#trfcob").css("display","none"):($("#trfcob").css("display",""),click_cambiar_fcob())}})}function cargar_formas_cobro_alta(){$.ajax({url:"/fnajax/ajxcargarfcobros.php?alta=1",type:"get",success:function(a){$("#tdformacobro").html(a),(a.match(/option/g)||[]).length>2?$("#trfcob").css("display",""):$("#trfcob").css("display","none")}})}function cargar_formas_cobro_tpv(){$.ajax({url:"/fnajax/ajxcargarfcobros.php?tpv=1",type:"get",success:function(a){$("#tdformacobro").html(a),(a.match(/option/g)||[]).length>2?$("#trfcob").css("display",""):$("#trfcob").css("display","none")}})}function cargar_vincular_tarjeta(){$.ajax({url:"/fnajax/ajxupay.php",type:"get",success:function(a){"OK"==a?$("#trupay").css("display",""):$("#trupay").css("display","none")}}),$.ajax({url:"/fnajax/ajxupaycli.php",type:"get",success:function(a){"OK"==a?$("#tdupay").html(funcionsi18n.tarjvinc+'&nbsp;&nbsp;<button type="button" onclick="verifupay(); return false;">'+funcionsi18n.cmbtarjvinc+"</button>"):$("#tdupay").html('<button type="button" onclick="verifupay(); return false;">'+funcionsi18n.vinc+"</button>")}})}function reservaweb(a,e,n){1==$("#accion").val()?reserva(a,e,n):2==$("#accion").val()&&0==$("#oldres").val()?cambiarreserva(a,e,n):2==$("#accion").val()&&$("#oldres").val()>0?cambiarreserva2(a,e,n):3==$("#accion").val()&&anularreserva(a,e,n)}function mifecha(a,e){if(-1!=a.indexOf("/")){var n=a.indexOf("/",1),t=a.indexOf("/",n+1);this.dia=a.substring(0,n),this.mes=a.substring(n+1,t)-1,this.any=a.substring(t+1,a.length);var i=new Date(1e3*e);this.mm=i.getMinutes(),this.hh=i.getHours()}else this.mm=0,this.hh=0,this.dia=0,this.mes=0,this.any=0}function anularreserva(a,e,n){var t=new mifecha($("#res_cal").val(),e),i=new Date(t.any,t.mes,t.dia,t.hh,t.mm,0,0),r=new Date,o=(i.getTime()-r.getTime())/36e5,s=t.mes+1<9?"0"+(t.mes+1):t.mes+1,c=t.mm<10?"0"+t.mm:t.mm,l=funcionsi18n.desde+" "+t.dia+"/"+s+"/"+t.any+" "+funcionsi18n.alas+" "+t.hh+":"+c;lithoraslimite=Math.round(60*horaslimite)+" "+funcionsi18n.mins,null==n?alert(funcionsi18n.debeselanul):$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+n,type:"get",success:function(a){"KO"==a?alert(funcionsi18n.debeselresrv):o<horaslimite?alert(funcionsi18n.noanularactv+lithoraslimite+funcionsi18n.antesdelam):1==confirm(funcionsi18n.vaaanularresrv+l)&&$.ajax({url:"/fnajax/ajxborrarreserva.php?idreserva="+a,type:"get",success:function(a){"OK"!=a&&alert(a),mostrar_res()}})}})}function cambiarreserva(a,e,n){var t=new mifecha($("#res_cal").val(),e),i=new Date(t.any,t.mes,t.dia,t.hh,t.mm,0,0),r=new Date,o=(i.getTime()-r.getTime())/36e5,s=t.mes+1<9?"0"+(t.mes+1):t.mes+1,c=t.mm<10?"0"+t.mm:t.mm,l=funcionsi18n.desde+" "+t.dia+"/"+s+"/"+t.any+" "+funcionsi18n.alas+" "+t.hh+":"+c;lithoraslimite=Math.round(60*horaslimite)+" "+funcionsi18n.mins,null==n?alert(funcionsi18n.debeselacamb):$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+n,type:"get",success:function(n){"KO"==n?alert(funcionsi18n.debeselresrv):$.ajax({url:"/fnajax/ajxcheckcancel.php?idreserva="+n,type:"get",success:function(t){""!=t?alert(t):o<horaslimite?alert(funcionsi18n.nocambiaactv+lithoraslimite+funcionsi18n.antesdelam):1==confirm(funcionsi18n.vaacambiarresrv+l+funcionsi18n.acepynuefec)&&($("#oldres").val(n),$("#tdcambios").html(funcionsi18n.cambiandoresv+l),$("#tracts").css("display","none"),fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),$.ajax({url:"/fnajax/ajxreservas.php?tipo=1&fecha="+fecha+"&idplanning="+tipoact+"&idplan="+a.idplanning+"&hora="+e+"&idreserva="+n,type:"get",success:function(a){$("#reserva").html(a),$("#framesactuales").val($("#frames").val()),$("#paxactuales").val($("#numpax").val())}}))}})}})}function cambiarreserva2(a,e,n){fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),$.ajax({url:"/fnajax/ajxreservas.php?tipo=2&fecha="+fecha+"&idplanning="+tipoact+"&idplan="+a.idplanning+"&hora="+e,type:"get",success:function(n){$("#reserva").html(n),$("#framesdisponibles").val($("#frames").val()),$("#framesdisponibles").val()>=$("#framesactuales").val()||$("#plazas").val()>$("#paxactuales").val()?$.ajax({url:"/fnajax/ajxcambiarreserva.php?idplanning="+a.idplanning+"&oldreserva="+$("#oldres").val()+"&fecha="+$("#res_cal").val()+"&hora="+e,type:"get",success:function(a){""!=a?(alert(a),mostrar_res()):(mostrar_res(),alert(funcionsi18n.reservacambiado),$("#oldres").val(0),$("#tdcambios").html(""),$("#tracts").css("display",""))}}):(alert(funcionsi18n.nosufespacioplan),mostrar_res())}})}function reserva(a,e,n){null==n&&(n="");$("#res_cal").val();var t=$("#tipoactividad").val(),i=$("#extender").val(),r=$("#lim_ext").val(),o=new mifecha($("#res_cal").val(),e),s=new Date(o.any,o.mes,o.dia,o.hh,o.mm,0,0),c=new Date,l=(s.getTime()-c.getTime())/36e5;$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+n,type:"get",success:function(n){lithoraslimite=horaslimite<1?Math.round(60*horaslimite)+" "+funcionsi18n.mins:horaslimite+" "+funcionsi18n.hors,"KO"!=n?alert(funcionsi18n.yatieneunaresva):$("#pax").val()<1?alert(funcionsi18n.debeindicnumper):l<horaslimite?alert(funcionsi18n.notiemporesva+lithoraslimite+funcionsi18n.antelacion):(fec=$("#res_cal").val(),t=$("#tipoactividad").val(),prodtmp=$("#producto").val(),prodarr=prodtmp.split("."),prod=prodarr[0],pax=$("#pax").val(),tipocargo=$("#tipocargo").val(),tarifa=0,1==tipocargo&&(tarifa=$("#tarifa").val()),"none"==$("#trfcob").css("display")?formacobro=-1:formacobro=$("#formacobro").val(),$.ajax({url:"/fnajax/ajxreservar.php?idplanning="+a.idplanning+"&tipoactividad="+t+"&producto="+prod+"&fecha="+fec+"&hora="+e+"&pax="+pax+"&formacobro="+formacobro+"&tarifa="+tarifa+"&extender="+i+"&limiteextender="+r,type:"get",success:function(a){$("#reserva").html(a),errorrva=$("#errorrva").val(),"1"==errorrva?(alert($("#resultado").val()),mostrar_res()):-1!=formacobro&&-1==formacobro.indexOf(",")?("OK"!=$("#resultado").val()&&alert($("#resultado").val()),$("#payform").submit()):(alert($("#resultado").val()),mostrar_res())}}))}})}function logout(a){$.ajax({url:"/cerrarsesion.php",type:"get",success:function(e){null==a?window.location.reload():document.location.href=a}})}function changelogin(){id=$("#cambionuevocliente").val(),$.ajax({url:"/cambiosesion.php?id="+id,type:"get",success:function(a){window.location.reload()}})}function mostrar_ext(){fini=$("#fini_cal").val(),ffin=$("#ffin_cal").val(),$.ajax({url:"/fnajax/ajxextracto.php?fini="+fini+"&ffin="+ffin,type:"get",success:function(a){$("#elextracto").html(a),switched=!1,updateTables()}})}function mostrar_cons_res(){fini=$("#fini_cal").val(),ffin=$("#ffin_cal").val(),$.ajax({url:"/fnajax/ajxconsreservas.php?fini="+fini+"&ffin="+ffin,type:"get",success:function(a){""!=a?$("#consultascontenido").html(a):$("#consultascontenido").html(funcionsi18n.notienesreservas)}})}function mostrar_multiuser(){email=$("#email").val(),$.ajax({url:"/fnajax/ajxnummail.php?email="+email,type:"get",success:function(a){a>1?$.ajax({url:"/fnajax/ajxcargarusers.php?email="+email,type:"get",success:function(a){$("#tdmultiuser").html(a),$("#trmultiuser").css("display","")}}):($("#tdmultiuser").html(""),$("#trmultiuser").css("display","none"))}})}function accion_despues_anadir(a,e,n){"S"==a?window.open(e,"_self"):$.ajax({url:"/fnajax/ajxurlmodulo.php?modul=-22&idioma="+n,type:"get",success:function(a){window.open("/"+a,"_self")}})}function anadir_carrito(a,e,n){var t=funcionsi18n.proaddcorrec,i=funcionsi18n.carrito,r=funcionsi18n.seguircomprando,o=funcionsi18n.validarcesta,s=0;$("#prodval").val()&&(s=$("#prodval").val()),$.ajax({url:"/fnajax/ajxanadircarrito.php?opc=0&idprod="+a+"&cantidad="+$("#cantidadcarrito").val()+"&idvaloratributo="+s,type:"get",success:function(a){new Messi(t,{title:i,width:"700px",buttons:[{id:0,label:r,val:"S"},{id:1,label:o,val:"V"}],callback:function(a){accion_despues_anadir(a,e,n)}})}})}function sumar_carrito(a,e){$.ajax({url:"/fnajax/ajxanadircarrito.php?opc=1&idprod="+a+"&idvaloratributo="+e,type:"get",success:function(a){window.location.reload()}})}function restar_carrito(a,e){$.ajax({url:"/fnajax/ajxanadircarrito.php?opc=2&idprod="+a+"&idvaloratributo="+e,type:"get",success:function(a){window.location.reload()}})}function eliminar_carrito(a,e){$.ajax({url:"/fnajax/ajxanadircarrito.php?opc=3&idprod="+a+"&idvaloratributo="+e,type:"get",success:function(a){window.location.reload()}})}function cantidad_carrito(a,e,n){$.ajax({url:"/fnajax/ajxanadircarrito.php?opc=4&idprod="+a+"&idvaloratributo="+e+"&cantidad="+n,type:"get",success:function(a){window.location.reload()}})}function validar_carrito(a){$.ajax({url:"/fnajax/ajxurlmodulo.php?modul=-23&idioma="+a,type:"get",success:function(a){window.open("/"+a,"_self")}})}function cargar_formas_cobro_tienda(){$.ajax({url:"/fnajax/ajxcargarfcobros.php?tienda=1",type:"get",success:function(a){$("#tdformacobro").html(a)}})}function anadircupon(){var a=$("#addcupon").val();$.ajax({url:"/fnajax/ajxcheckcupon.php?cupon="+a,type:"get",success:function(a){"OK"!=a?alert(a):window.location.reload()}})}function pagarcompra(a){var e=$("#formacobro").val(),n=$("#formaenvio").val()?$("#formaenvio").val():0;$.ajax({url:"/fnajax/ajxpagarcompra.php?formacobro="+e+"&formaenvio="+n,type:"get",success:function(n){-1!=e&&-10!=e?($("#elpago").html(n),"OK"!=$("#resultado").val()&&alert($("#resultado").val()),0==parseFloat($("#imptotal").val())||void 0!==$("#merchant_id").val()?$.ajax({url:"/fnajax/ajxurlmodulo.php?modul=-2&idioma="+a,type:"get",success:function(a){window.open("/"+a,"_self")}}):$("#payform").submit()):$.ajax({url:"/fnajax/ajxurlmodulo.php?modul=-2&idioma="+a,type:"get",success:function(a){window.open("/"+a,"_self")}})}})}function cargar_benef(a,e,n){$.ajax({url:"/fnajax/ajxcargarbenef.php?opc=2&idprod="+a+"&idcli="+e+"&ntot="+n,type:"get",success:function(t){$("#beneficiarios_"+a).html(t),mostrar_anadir(a,e,n)}})}function delcli(a,e,n,t){$.ajax({url:"/fnajax/ajxcargarbenef.php?opc=3&idprod="+a+"&idcli="+e+"&idben="+n+"&ntot="+t,type:"get",success:function(n){$("#beneficiarios_"+a).html(n),mostrar_anadir(a,e,t)}})}function addcli(a,e,n,t){$.ajax({url:"/fnajax/ajxcargarbenef.php?opc=4&idprod="+a+"&idcli="+e+"&idben="+n+"&ntot="+t,type:"get",success:function(n){$("#beneficiarios_"+a).html(n),mostrar_anadir(a,e,t),parent.$.colorbox.close()}})}function mostrar_anadir(a,e,n){$("#beneficiarios_"+a).find("tr").size()<n?$("#anadir_"+a).css("display",""):$("#anadir_"+a).css("display","none")}function mostrar_busq(a,e,n){$.ajax({url:"/fnajax/ajxcargarbenef.php?opc=0&idprod="+a+"&idcli="+e+"&ntot="+n,type:"get",success:function(e){$("#inline_"+a).html(e)}})}function mostrar_benefs(a,e,n,t,i){$.ajax({url:"/fnajax/ajxcargarbenef.php?opc=1&idprod="+a+"&idcli="+e+"&ntot="+n+"&nombre="+t+"&apellidos="+i,type:"get",success:function(e){$("#inline_res_"+a).html(e)}})}function mostrar_pagostpv(){var a=$("#pagotpvseleccion").val();switch($("#pagotpvconcepto").css("display","none"),$("#pagotpvrecibo").css("display","none"),$("#pagotpvventa").css("display","none"),a){case"1":$.ajax({url:"/fnajax/ajxcargarpendiente.php",type:"get",success:function(a){$("#importetpv").val(a)}}),$("#pagotpvconcepto").css("display","");break;case"2":$.ajax({url:"/fnajax/ajxcargarrecibosdev.php",type:"get",success:function(a){$("#pagorecibo-recibos").html(a)}}),$("#pagotpvrecibo").css("display","");break;case"3":$.ajax({url:"/fnajax/ajxcargarventas.php",type:"get",success:function(a){$("#pagoventa-ventas").html(a)}}),$("#pagotpvventa").css("display","")}}function validarpagostpv(){switch($("#pagotpvseleccion").val()){case"1":var a=$("#conceptotpv").val(),e=$("#importetpv").val();""==a||""==e||0==e?alert(funcionsi18n.debetodoscampos):$("#frmpagostpv").submit();break;case"2":0==$("#recibotpv").val()?alert(funcionsi18n.norecibdev):$("#frmpagostpv").submit();break;case"3":0==$("#ventatpv").val()?alert(funcionsi18n.noventaspendientes):$("#frmpagostpv").submit()}}function pagarcompratpv(){var a=$("#tipotpv").val(),e=$("#vtarebtpv").val(),n=$("#descripciontpv").val(),t=$("#importetpv").val();"none"==$("#trfcob").css("display")?formacobro=-1:formacobro=$("#formacobro").val(),$.ajax({url:"/fnajax/ajxpagartpv.php?formacobro="+formacobro+"&tipotpv="+a+"&vtarebtpv="+e+"&descripciontpv="+n+"&importetpv="+t,type:"get",success:function(a){$("#elpagotpv").html(a),"OK"!=$("#resultadotpv").val()&&alert($("#resultadotpv").val()),void 0!==$("#merchant_id").val()?window.location="/":$("#payform").submit()}})}function pagaralta(){var a=$("#matricula").val(),e=$("#importe").val(),n=$("#idtrans").val(),t=$("#merchant_id").val();"none"==$("#trfcob").css("display")?formacobro=-1:formacobro=$("#formacobro").val(),$.ajax({url:"/fnajax/ajxpagaralta.php?formacobro="+formacobro+"&matricula="+a+"&importe="+e+"&idtrans="+n+"&merchant_id="+t,type:"get",success:function(a){if($("#elpago").html(a),"OK"!=$("#resultado").val()&&alert($("#resultado").val()),void 0!==t){var e=a.indexOf("value='"),n=a.indexOf("'",e+7),i=a.substring(e+7,n);window.open("/"+i,"_self")}else $("#payform").submit()}})}function cargar_acts_plann(){fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),0==$("#oldres").val()?$.ajax({url:"/fnajax/ajxcargaractsplan.php?fecha="+fecha+"&tipoact="+tipoact,type:"get",success:function(a){$("#tdtipoactividad").html(a),mostrar_plann()}}):mostrar_plann()}function mostrar_plann(){$("#trplanselect").css("display","none"),$("#trprod").css("display","none"),$("#trpax").css("display","none"),$("#trfcob").css("display","none"),$("#trreservar").css("display","none"),$("#tranular").css("display","none"),$("#trextend").css("display","none"),$("#trextendfin").css("display","none"),$("#res_cal").prop("disabled",!1),$("#tipoactividad").prop("disabled",!1),$("#titplanning").css("display",""),$("#reserva").css("display",""),fecha=$("#res_cal").val(),tipoact=$("#tipoactividad").val(),$.ajax({url:"/fnajax/ajxplanning.php?fecha="+fecha+"&idtipoact="+tipoact,type:"get",success:function(a){$("#reserva").html(a),switched=!1,updateTables()}})}function verplanning(a,e,n){null==n&&(n="");$("#res_cal").val(),$("#tipoactividad").val();var t=new mifecha($("#res_cal").val(),e),i=new Date(t.any,t.mes,t.dia,t.hh,t.mm,0,0),r=new Date;i.getTime(),r.getTime();$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+n,type:"get",success:function(i){if("KO"==i){$("#titplanning").css("display","none"),$("#reserva").css("display","none");var r=t.hh;t.hh<10&&(r="0"+r);var o=t.mm;t.mm<10&&(o="0"+o);var s=decodeURI(a.descripcion).replace(/\+/g," ");$("#tdplanselect").html(r+":"+o+" "+s),$("#trplanselect").css("display",""),$("#trpax").css("display",""),$("#trreservar").css("display",""),$("#res_cal").prop("disabled",!0),$("#tipoactividad").prop("disabled",!0),cargar_prods_plan(a.idplanning,e,n)}else{$("#titplanning").css("display","none"),$("#reserva").css("display","none");r=t.hh;t.hh<10&&(r="0"+r);o=t.mm;t.mm<10&&(o="0"+o);s=decodeURI(a.descripcion).replace(/\+/g," ");$("#tdplanselect").html(r+":"+o+" "+s),$("#trplanselect").css("display",""),$("#tranular").css("display",""),$("#tdproducto").html('<input type="hidden" name="idplanning" value="'+a.idplanning+'" id="idplanning"><input type="hidden" name="hora" value="'+e+'" id="hora"><input type="hidden" name="idreservas" value="'+n+'" id="idreservas">')}}})}function cargar_prods_plan(a,e,n){idplanning=void 0!==a?a:$("#idplanning").val(),hora=void 0!==e?e:$("#hora").val(),idreservas=void 0!==n?n:$("#idreservas").val(),tipocargo=0,$("#tipocargo").val()>=0&&(tipocargo=$("#tipocargo").val()),$("#trfcob").css("display","none"),$("#trprod").css("display","none"),$.ajax({url:"/fnajax/ajxcargarprods.php?idplanning="+idplanning+"&tipocargo="+tipocargo+"&tipo=2",type:"get",success:function(a){""==a?($("#tdproducto").html('<input type="hidden" name="tipocargo" value="0" id="tipocargo"><input type="hidden" name="esextendible" value="0" id="esextendible"><select name="producto" id="producto" onchange="mostrar_plann();"></select>'),$("#trprod").css("display","none"),$("#formacobro").val(0)):(responsefilt=JSON.parse(a),$("#pax").val(responsefilt.pax),$("#tdproducto").html('<input type="hidden" name="idplanning" value="'+idplanning+'" id="idplanning"><input type="hidden" name="hora" value="'+hora+'" id="hora"><input type="hidden" name="idreservas" value="'+idreservas+'" id="idreservas"><input type="hidden" name="esextendible" value="'+responsefilt.extendible+'" id="esextendible">'+responsefilt.html),1==responsefilt.extendible?($("#trextend").css("display",""),$("#trextendfin").css("display",""),$("#lim_ext").val(responsefilt.fechaextendible)):($("#trextend").css("display","none"),$("#trextendfin").css("display","none")),$("#producto").val()>0?(cargar_formas_cobro(),$("#trprod").css("display","")):$("#tdformacobro").html(""),2==$("#tipocargo").val()&&$("#producto").val()>0?($("#trfcob").css("display",""),$("#trprod").css("display","")):1==$("#tipocargo").val()&&$("#trprod").css("display",""))}})}function reservaplanning(a,e){var n=$("#idplanning").val(),t=$("#hora").val(),i=$("#idreservas").val(),r=funcionsi18n.mins,o=funcionsi18n.hors,s=funcionsi18n.yatieneunaresva,c=funcionsi18n.debeindicnumper,l=funcionsi18n.notiemporesva,p=funcionsi18n.antelacion,d=($("#res_cal").val(),$("#tipoactividad").val()),u=$("#extender").val(),f=$("#lim_ext").val(),m=new mifecha($("#res_cal").val(),t),v=new Date(m.any,m.mes,m.dia,m.hh,m.mm,0,0),h=new Date,g=(v.getTime()-h.getTime())/36e5;$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+i,type:"get",success:function(a){lithoraslimite=horaslimite<1?Math.round(60*horaslimite)+" "+r:horaslimite+" "+o,"KO"!=a?alert(s):$("#pax").val()<1?alert(c):g<horaslimite?alert(l+lithoraslimite+p):(fec=$("#res_cal").val(),d=$("#tipoactividad").val(),prodtmp=$("#producto").val(),prodarr=prodtmp.split("."),prod=prodarr[0],pax=$("#pax").val(),tipocargo=$("#tipocargo").val(),segmentos=$("#segmentos").val(),tarifa=0,1==tipocargo&&(tarifa=$("#tarifa").val()),"none"==$("#trfcob").css("display")?formacobro=-1:formacobro=$("#formacobro").val(),$.ajax({url:"/fnajax/ajxreservar.php?idplanning="+n+"&tipoactividad="+d+"&producto="+prod+"&fecha="+fec+"&hora="+t+"&pax="+pax+"&formacobro="+formacobro+"&tarifa="+tarifa+"&segmentos="+segmentos+"&extender="+u+"&limiteextender="+f,type:"get",success:function(a){$("#reserva").html(a),errorrva=$("#errorrva").val(),"1"==errorrva?(alert($("#resultado").val()),mostrar_plann()):-1!=formacobro&&-1==formacobro.indexOf(",")?("OK"!=$("#resultado").val()&&alert($("#resultado").val()),0==$("#imp").val()?mostrar_plann():$("#payform").submit()):(alert($("#resultado").val()),mostrar_plann())}}))}})}function anularplanning(a,e){var n=$("#hora").val(),t=$("#idreservas").val(),i=new mifecha($("#res_cal").val(),n),r=new Date(i.any,i.mes,i.dia,i.hh,i.mm,0,0),o=new Date,s=(r.getTime()-o.getTime())/36e5,c=i.mes+1<9?"0"+(i.mes+1):i.mes+1,l=i.mm<10?"0"+i.mm:i.mm,p=funcionsi18n.desde+i.dia+"/"+c+"/"+i.any+funcionsi18n.alas+i.hh+":"+l;lithoraslimite=Math.round(60*horaslimite)+" "+funcionsi18n.mins,$.ajax({url:"/fnajax/ajxreservascli.php?idreservas="+t,type:"get",success:function(a){"KO"==a?alert(funcionsi18n.debeselresrv):s<horaslimite?alert(funcionsi18n.noanularactv+lithoraslimite+funcionsi18n.antesdelam):1==confirm(funcionsi18n.vaaanularresrv+p)&&$.ajax({url:"/fnajax/ajxborrarreserva.php?idreserva="+a,type:"get",success:function(a){"OK"!=a&&alert(a),mostrar_plann()}})}})}function anularplanningcons(a,e,n){1==confirm(funcionsi18n.vaaanularresrv)&&$.ajax({url:"/fnajax/ajxborrarreserva.php?idreserva="+a,type:"get",success:function(a){"OK"!=a&&alert(a),null==e&&(e=-8),$.ajax({url:"/fnajax/ajxurlmodulo.php?modul="+e+"&idioma="+n,type:"get",success:function(a){window.open("/"+a,"_self")}})}})}function cargar_formscli(a){$.ajax({url:"/fnajax/ajxcargarformscli.php?selec="+a,type:"get",success:function(a){$("#formulario_sel").html(a)}})}function mostrar_formcli(){frm_desde=$("#frm_desde").val(),frm_hasta=$("#frm_hasta").val(),tipoformulario=$("#tipoformulario").val(),$.ajax({url:"/fnajax/ajxformularioscliente.php?frm_desde="+frm_desde+"&frm_hasta="+frm_hasta+"&tipoformulario="+tipoformulario,type:"get",success:function(a){$("#formularioscli").html(a),switched=!1,updateTables()}})}function ordenar_geoposicion(){var a=gMap.getCenter().lat(),e=gMap.getCenter().lng();for(x=0;x<puntos.length;x++)$.ajax({url:"/fnajax/ajxgpsdist.php?x="+x+"&lat1="+a+"&long1="+e+"&lat2="+puntos[x][5]+"&long2="+puntos[x][6],type:"get",async:!1,success:function(a){responsefilt=JSON.parse(a),puntos[responsefilt.x][8]=responsefilt.km}});var n=document.getElementById("map_id_lista");!function(){for(var a=0;a<=n.children.length-1;a++)for(porciones=n.children[a].id.split("_"),x=0;x<puntos.length;x++)porciones[1]==puntos[x][5]&&porciones[2]==puntos[x][6]&&(n.children[a].id=puntos[x][8]+"_"+puntos[x][5]+"_"+puntos[x][6])}();var t=document.getElementById("map_id_lista");[].map.call(t.children,Object).sort((function(a,e){return+a.id.match(/\d+/)-+e.id.match(/\d+/)})).forEach((function(a){t.appendChild(a)}))}function recarga_fra(a){$.ajax({url:"/fnajax/ajxcmpesptari.php?idbase="+a,type:"get",async:!1,success:function(a){responsefilt=JSON.parse(a),$.each(responsefilt,(function(a,e){$("[name=frm\\["+e.id+"\\]]").replaceWith(e.content)}))}})}function recarga_trfas(a,e){$.ajax({url:"/fnajax/ajxcmpesptari2.php?idbase="+a+"&idclas="+e,type:"get",async:!1,success:function(a){responsefilt=JSON.parse(a),$.each(responsefilt,(function(a,e){$("[name=frm\\["+e.id+"\\]]").replaceWith(e.content)}))}})}function recargarupay(){winupay.close(),$("#tdupay").html(funcionsi18n.tarjvinc+'&nbsp;&nbsp;<button type="button" onclick="verifupay(); return false;">'+funcionsi18n.cmbtarjvinc+"</button>")}function verifupay(){winupay=window.open("universalpay/pverifupay.php","vpay","width=600px,height=600px,resizable = no,location=no")}function verticket(a){if(null==a){var e=document.getElementById("ventatpv");a=e.options[e.selectedIndex].value}window.open("verticket.php?nopdf=1&id="+a,"ticket_pdf")}function vercodbarras(a){window.open("/vercodbarras.php?id="+a,"reserva_pdf")}function guardarcookies(){var a=new Date;a.setTime(a.getTime()+31536e6);var e="expires="+a.toUTCString();1==document.getElementById("fccksnecesarias").checked&&(document.cookie="_FCcksNecesarias=1;"+e+";path=/"),1==document.getElementById("fcckspreferencias").checked&&(document.cookie="_FCcksPreferencias=1;"+e+";path=/"),1==document.getElementById("fccksestadistica").checked&&(document.cookie="_FCcksEstadistica=1;"+e+";path=/"),1==document.getElementById("fccksmarketing").checked&&(document.cookie="_FCcksMarketing=1;"+e+";path=/"),document.getElementById("fccksidcookies").style.display="none"}function cambiopagador(){$.ajax({url:"/fnajax/ajxguardarpagadores.php",type:"post",data:$('input[name="parapagar[]"]:checked').serialize(),success:function(a){alert(a),window.location.reload()}})}function enviopagador(a){$.ajax({url:"/fnajax/ajxenviopagador.php?idioma="+a,type:"post",data:$("#mailcli").serialize(),success:function(a){alert(a),window.location.reload()}})}function Filevalidation(a){const e=document.getElementById(a);if(e.files.length>0)for(const n=0;n<=e.files.length-1;n++){const t=e.files.item(n).size;Math.round(t/1024)>=2048?(document.getElementById(a).value="",document.getElementById(a+"-c").value="0",alert(funcionsi18n.ficherogrande)):document.getElementById(a+"-c").value="1"}}function setsessioned(a){$.ajax({url:"/cambiosesionedicion.php?valor="+a,type:"get",success:function(a){window.location.reload()}})}function mostraraforo(){var a=document.getElementById("idcontentaforoFC").getAttribute("data-recinto");$.ajax({url:"/fnajax/ajxcargaraforo.php?recinto="+a,type:"get",success:function(a){"function"==typeof mostraraforoalt?mostraraforoalt(a):$("#idcontentaforoFC").html(a)}})}$(document).ready((function(a){a(".galeriacb").colorbox({rel:"galeriacb"})}));