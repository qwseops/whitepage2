Calendar=function(){function t(t){return"string"==typeof t&&(t=document.getElementById(t)),t}function e(t,e,n){for(n=0;n<t.length;++n)e(t[n])}function n(t){var e,a,s=0,i=0,r=/^div$/i.test(t.tagName);return r&&t.scrollLeft&&(s=t.scrollLeft),r&&t.scrollTop&&(i=t.scrollTop),e={x:t.offsetLeft-s,y:t.offsetTop-i},t.offsetParent&&(a=n(t.offsetParent),e.x+=a.x,e.y+=a.y),e}function a(t,e){var n=J?t.clientX+document.body.scrollLeft:t.pageX,a=J?t.clientY+document.body.scrollTop:t.pageY;return e&&(n-=e.x,a-=e.y),{x:n,y:a}}function s(t,e){var n=t.style;return null!=e&&(n.display=e?"":"none"),"none"!=n.display}function i(t,e){return""===e?J?t.style.filter="":t.style.opacity="":null!=e?J?t.style.filter="alpha(opacity="+100*e+")":t.style.opacity=e:J?/alpha\(opacity=([0-9.])+\)/.test(t.style.opacity)&&(e=parseFloat(RegExp.$1)/100):e=parseFloat(t.style.opacity),e}function r(t,e,n){function a(){var e=t.len;t.onUpdate(n/e,r),n==e&&s(),++n}function s(){e&&(clearInterval(e),e=null),t.onStop(n/t.len,r)}function i(){e&&s(),n=0,e=setInterval(a,1e3/t.fps)}function r(t,e,n,a){return a?n+t*(e-n):e+t*(n-e)}return t=v(t,{fps:50,len:15,onUpdate:lt,onStop:lt}),J&&(t.len=Math.round(t.len/2)),i(),{start:i,stop:s,update:a,args:t,map:r}}function o(t,e){if(!e(t))for(var n=t.firstChild;n;n=n.nextSibling)1==n.nodeType&&o(n,e)}function l(t,e){var n=c(arguments,2);return null==e?function(){return t.apply(this,n.concat(c(arguments)))}:function(){return t.apply(e,n.concat(c(arguments)))}}function c(t,e){var n,a,s;null==e&&(e=0);try{n=Array.prototype.slice.call(t,e)}catch(i){for(n=Array(t.length-e),a=e,s=0;a<t.length;++a,++s)n[s]=t[a]}return n}function h(t,e,n){var a=null;return a=document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",t):document.createElement(t),e&&(a.className=e),n&&n.appendChild(a),a}function u(t,e,n){if(e instanceof Array)for(var a=e.length;--a>=0;)u(t,e[a],n);else f(e,n,t?n:null);return t}function d(t,e){return f(t,e,e)}function f(t,e,n){if(t){var a,s=t.className.replace(/^\s+|\s+$/,"").split(/\x20/),i=[];for(a=s.length;a>0;)s[--a]!=e&&i.push(s[a]);n&&i.push(n),t.className=i.join(" ")}return n}function y(t){return t=t||window.event,J?(t.cancelBubble=!0,t.returnValue=!1):(t.preventDefault(),t.stopPropagation()),!1}function p(t,e,n,a){if(t instanceof Array)for(var s=t.length;--s>=0;)p(t[s],e,n);else if("object"==typeof e)for(var s in e)e.hasOwnProperty(s)&&p(t,s,e[s],n);else t.removeEventListener?t.removeEventListener(e,n,!!J||!!a):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function m(t,e,n,a){if(t instanceof Array)for(var s=t.length;--s>=0;)m(t[s],e,n,a);else if("object"==typeof e)for(var s in e)e.hasOwnProperty(s)&&m(t,s,e[s],n);else t.addEventListener?t.addEventListener(e,n,!!J||!!a):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function v(t,e,n,a){for(n in a={},e)e.hasOwnProperty(n)&&(a[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(a[n]=t[n]);return a}function g(t){if(/\S/.test(t)){function e(e){for(var n=e.length;--n>=0;)if(0==e[n].toLowerCase().indexOf(t))return n+1}return t=t.toLowerCase(),e(T("smn"))||e(T("mn"))}}function D(t){if(t){if("number"==typeof t)return w(t);if(!(t instanceof Date)){var e=t.split(/-/);return new Date(parseInt(e[0],10),parseInt(e[1],10)-1,parseInt(e[2],10),12,0,0,0)}}return t}function b(t,e){var n,a=t.getMonth(),s=t.getDate(),i=t.getFullYear(),r=_(t),o=t.getDay(),l=t.getHours(),c=l>=12,h=c?l-12:l,u=function(t){t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0);var e=new Date(t.getFullYear(),0,1,12,0,0),n=t-e;return Math.floor(n/864e5)}(t),d=t.getMinutes(),f=t.getSeconds();return 0===h&&(h=12),n={"%a":T("sdn")[o],"%A":T("dn")[o],"%b":T("smn")[a],"%B":T("mn")[a],"%C":1+Math.floor(i/100),"%d":s<10?"0"+s:s,"%e":s,"%H":l<10?"0"+l:l,"%I":h<10?"0"+h:h,"%j":u<10?"00"+u:u<100?"0"+u:u,"%k":l,"%l":h,"%m":a<9?"0"+(1+a):1+a,"%o":1+a,"%M":d<10?"0"+d:d,"%n":"\n","%p":c?"PM":"AM","%P":c?"pm":"am","%s":Math.floor(t.getTime()/1e3),"%S":f<10?"0"+f:f,"%t":"\t","%U":r<10?"0"+r:r,"%W":r<10?"0"+r:r,"%V":r<10?"0"+r:r,"%u":o+1,"%w":o,"%y":(""+i).substr(2,2),"%Y":i,"%%":"%"},e.replace(/%./g,(function(t){return n.hasOwnProperty(t)?n[t]:t}))}function C(t,e,n){var a=t.getFullYear(),s=t.getMonth(),i=t.getDate(),r=e.getFullYear(),o=e.getMonth(),l=e.getDate();return a<r?-3:a>r?3:s<o?-2:s>o?2:n?0:i<l?-1:i>l?1:0}function w(t,e,n,a,s){if(!(t instanceof Date)){t=parseInt(t,10);var i=Math.floor(t/1e4);t%=1e4;var r=Math.floor(t/100);t%=100,t=new Date(i,r-1,t,null==e?12:e,null==n?0:n,null==a?0:a,null==s?0:s)}return t}function M(t){return t instanceof Date?1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate():"string"==typeof t?parseInt(t,10):t}function _(t){var e=(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0)).getDay();t.setDate(t.getDate()-(e+6)%7+3);var n=t.valueOf();return t.setMonth(0),t.setDate(4),Math.round((n-t.valueOf())/6048e5)+1}function T(t,e){var n=et.__.data[t];return e&&"string"==typeof n&&(n=x(n,e)),n}function x(t,e){return t.replace(/\$\{([^:\}]+)(:[^\}]+)?\}/g,(function(t,n,a){var s,i=e[n];return a&&(s=a.substr(1).split(/\s*\|\s*/),i=(i>=s.length?s[s.length-1]:s[i]).replace(/##?/g,(function(t){return 2==t.length?"#":i}))),i}))}function L(t){if(!this._menuAnim){var e=((t=t||window.event).target||t.srcElement).getAttribute("dyc-btn"),n=t.keyCode,a=t.charCode||n,s=it[n];if("year"==e&&13==n)return(h=new Date(this.date)).setDate(1),h.setFullYear(this._getInputYear()),this.moveTo(h,!0),N(this,!1),y(t);if(this._menuVisible){if(27==n)return N(this,!1),y(t)}else{if(t.ctrlKey||(s=null),null==s&&!t.ctrlKey&&(s=rt[n]),36==n&&(s=0),null!=s)return Y(this,s),y(t);a=String.fromCharCode(a).toLowerCase();var i=this.els.yearInput,r=this.selection;if(" "==a)return N(this,!0),this.focus(),i.focus(),i.select(),y(t);if(a>="0"&&a<="9")return N(this,!0),this.focus(),i.value=a,i.focus(),y(t);for(var o=T("mn"),l=t.shiftKey?-1:this.date.getMonth(),c=0;++c<12;){if(0==o[(l+c)%12].toLowerCase().indexOf(a))return(h=new Date(this.date)).setDate(1),h.setMonth((l+c)%12),this.moveTo(h,!0),y(t)}if(n>=37&&n<=40){var h;if((h=this._lastHoverDate)||r.isEmpty()||((h=n<39?r.getFirstDate():r.getLastDate())<this._firstDateVisible||h>this._lastDateVisible)&&(h=null),h){var u=h;h=w(h);for(l=100;l-- >0;){switch(n){case 37:h.setDate(h.getDate()-1);break;case 38:h.setDate(h.getDate()-7);break;case 39:h.setDate(h.getDate()+1);break;case 40:h.setDate(h.getDate()+7)}if(!this.isDisabled(h))break}((h=M(h))<this._firstDateVisible||h>this._lastDateVisible)&&this.moveTo(h)}else h=n<39?this._lastDateVisible:this._firstDateVisible;return f(this._getDateDiv(u),d(this._getDateDiv(h),"DynarchCalendar-hover-date")),this._lastHoverDate=h,y(t)}if(13==n&&this._lastHoverDate)return r.type==z.SEL_MULTIPLE&&(t.shiftKey||t.ctrlKey)?(t.shiftKey&&this._selRangeStart&&(r.clear(!0),r.selectRange(this._selRangeStart,this._lastHoverDate)),t.ctrlKey&&r.set(this._selRangeStart=this._lastHoverDate,!0)):r.reset(this._selRangeStart=this._lastHoverDate),y(t);27==n&&!this.args.cont&&this.hide()}}}function A(){this.refresh();var t=this.inputField,e=this.selection;if(t){var n=e.print(this.dateFormat);/input|textarea/i.test(t.tagName)?t.value=n:t.innerHTML=n}this.callHooks("onSelect",this,e)}function H(t){var e=I(t=t||window.event);if(e){var n=e.getAttribute("dyc-btn"),a=e.getAttribute("dyc-type"),s=t.wheelDelta?t.wheelDelta/120:-t.detail/3;if(s=s<0?-1:s>0?1:0,this.args.reverseWheel&&(s=-s),/^(time-(hour|min))/.test(a)){switch(RegExp.$1){case"time-hour":this.setHours(this.getHours()+s);break;case"time-min":this.setMinutes(this.getMinutes()+this.args.minuteStep*s)}y(t)}else/Y/i.test(n)&&(s*=2),Y(this,-s),y(t)}}function S(t,e){var n=I(e=e||window.event);if(n){var a=n.getAttribute("dyc-type");if(a&&!n.getAttribute("disabled")&&(!t||!this._bodyAnim||"date"!=a)){var s=n.getAttribute("dyc-cls");s=s?k(s,0):"DynarchCalendar-hover-"+a,("date"!=a||this.selection.type)&&u(t,n,s),"date"==a&&(u(t,n.parentNode.parentNode,"DynarchCalendar-hover-week"),this._showTooltip(n.getAttribute("dyc-date"))),/^time-hour/.test(a)&&u(t,this.els.timeHour,"DynarchCalendar-hover-time"),/^time-min/.test(a)&&u(t,this.els.timeMinute,"DynarchCalendar-hover-time"),f(this._getDateDiv(this._lastHoverDate),"DynarchCalendar-hover-date"),this._lastHoverDate=null}}t||this._showTooltip()}function k(t,e){return"DynarchCalendar-"+t.split(/,/)[e]}function I(t){for(var e=t.target||t.srcElement,n=e;e&&e.getAttribute&&!e.getAttribute("dyc-type");)e=e.parentNode;return e.getAttribute&&e||n}function E(t){t=t||window.event;var e=this.els.topCont.style,n=a(t,this._mouseDiff);e.left=n.x+"px",e.top=n.y+"px"}function B(t,e){var s=I(e=e||window.event);if(s&&!s.getAttribute("disabled")){var i,r=s.getAttribute("dyc-btn"),o=s.getAttribute("dyc-type"),c=s.getAttribute("dyc-date"),h=this.selection,u={mouseover:y,mousemove:y,mouseup:function(t){var e=s.getAttribute("dyc-cls");e&&f(s,k(e,1)),clearTimeout(i),p(document,u,!0),u=null}};if(t){setTimeout(l(this.focus,this),1);var v=s.getAttribute("dyc-cls");if(v&&d(s,k(v,1)),"menu"==r)this.toggleMenu();else if(s&&/^[+-][MY]$/.test(r))if(Y(this,r)){var g=l((function(){Y(this,r,!0)?i=setTimeout(g,40):(u.mouseup(),Y(this,r))}),this);i=setTimeout(g,350),m(document,u,!0)}else u.mouseup();else if("year"==r)this.els.yearInput.focus(),this.els.yearInput.select();else if("time-am"==o)m(document,u,!0);else if(/^time/.test(o)){g=l((function(t){F.call(this,t),i=setTimeout(g,100)}),this,o);F.call(this,o),i=setTimeout(g,350),m(document,u,!0)}else c&&h.type&&(h.type==z.SEL_MULTIPLE?e.shiftKey&&this._selRangeStart?h.selectRange(this._selRangeStart,c):(!e.ctrlKey&&!h.isSelected(c)&&h.clear(!0),h.set(c,!0),this._selRangeStart=c):(h.set(c),this.moveTo(w(c),2)),s=this._getDateDiv(c),S.call(this,!0,{target:s})),m(document,u,!0);J&&u&&/dbl/i.test(e.type)&&u.mouseup(),!this.args.fixed&&/^(DynarchCalendar-(topBar|bottomBar|weekend|weekNumber|menu(-sep)?))?$/.test(s.className)&&!this.args.cont&&(u.mousemove=l(E,this),this._mouseDiff=a(e,n(this.els.topCont)),m(document,u,!0))}else if("today"==r)!this._menuVisible&&h.type==z.SEL_SINGLE&&h.set(new Date),this.moveTo(new Date,!0),N(this,!1);else if(/^m([0-9]+)/.test(r)){(c=new Date(this.date)).setDate(1),c.setMonth(RegExp.$1),c.setFullYear(this._getInputYear()),this.moveTo(c,!0),N(this,!1)}else"time-am"==o&&this.setHours(this.getHours()+12);J||y(e)}}function N(t,e){t._menuVisible=e,u(e,t.els.title,"DynarchCalendar-pressed-title");var n=t.els.menu;if(Q&&(n.style.height=t.els.main.offsetHeight+"px"),t.args.animation){t._menuAnim&&t._menuAnim.stop();var a=t.els.main.offsetHeight;Q&&(n.style.width=t.els.topBar.offsetWidth+"px"),e&&(n.firstChild.style.marginTop=-a+"px",t.args.opacity>0&&i(n,0),s(n,!0)),t._menuAnim=r({onUpdate:function(s,r){n.firstChild.style.marginTop=r(ot.accel_b(s),-a,0,!e)+"px",t.args.opacity>0&&i(n,r(ot.accel_b(s),0,.85,!e))},onStop:function(){t.args.opacity>0&&i(n,.85),n.firstChild.style.marginTop="",t._menuAnim=null,e||(s(n,!1),t.focused&&t.focus())}})}else s(n,e),t.focused&&t.focus()}function Y(t,e,n){var a;if(this._bodyAnim&&this._bodyAnim.stop(),0!=e)switch((a=new Date(t.date)).setDate(1),e){case"-Y":case-2:a.setFullYear(a.getFullYear()-1);break;case"+Y":case 2:a.setFullYear(a.getFullYear()+1);break;case"-M":case-1:a.setMonth(a.getMonth()-1);break;case"+M":case 1:a.setMonth(a.getMonth()+1)}else a=new Date;return t.moveTo(a,!n)}function F(t){switch(t){case"time-hour+":this.setHours(this.getHours()+1);break;case"time-hour-":this.setHours(this.getHours()-1);break;case"time-min+":this.setMinutes(this.getMinutes()+this.args.minuteStep);break;case"time-min-":this.setMinutes(this.getMinutes()-this.args.minuteStep);break;default:return}}function P(){this._bluringTimeout=setTimeout(l(R,this),50)}function R(){this.focused=!1,f(this.els.main,"DynarchCalendar-focused"),this._menuVisible&&N(this,!1),this.args.cont||this.hide(),this.callHooks("onBlur",this)}function V(){this._bluringTimeout&&clearTimeout(this._bluringTimeout),this.focused=!0,d(this.els.main,"DynarchCalendar-focused"),this.callHooks("onFocus",this)}function U(t){var e=h("div"),n=t.els={},a={mousedown:l(B,t,!0),mouseup:l(B,t,!1),mouseover:l(S,t,!0),mouseout:l(S,t,!1),keypress:l(L,t)};return t.args.noScroll||(a[Z?"DOMMouseScroll":"mousewheel"]=l(H,t)),J&&(a.dblclick=a.mousedown,a.keydown=a.keypress),e.innerHTML=function(t){var e=["<table class='DynarchCalendar-topCont'",nt,"><tr><td>","<div class='DynarchCalendar'>",J?"<a class='DynarchCalendar-focusLink' href='#'></a>":"<button class='DynarchCalendar-focusLink'></button>","<div class='DynarchCalendar-topBar'>","<div dyc-type='nav' dyc-btn='-Y' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-prevYear'><div></div></div>","<div dyc-type='nav' dyc-btn='+Y' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-nextYear'><div></div></div>","<div dyc-type='nav' dyc-btn='-M' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-prevMonth'><div></div></div>","<div dyc-type='nav' dyc-btn='+M' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-nextMonth'><div></div></div>","<table class='DynarchCalendar-titleCont'",nt,"><tr><td>","<div dyc-type='title' dyc-btn='menu' dyc-cls='hover-title,pressed-title' class='DynarchCalendar-title'>",K(t),"</div></td></tr></table>","<div class='DynarchCalendar-dayNames'>",j(t),"</div>","</div>","<div class='DynarchCalendar-body'></div>"];return(t.args.bottomBar||t.args.showTime)&&e.push("<div class='DynarchCalendar-bottomBar'>",O(t),"</div>"),e.push("<div class='DynarchCalendar-menu' style='display: none'>",W(t),"</div>","<div class='DynarchCalendar-tooltip'></div>","</div>","</td></tr></table>"),e.join("")}(t),o(e.firstChild,(function(t){var e=at[t.className];e&&(n[e]=t),J&&t.setAttribute("unselectable","on")})),m(n.main,a),m([n.focusLink,n.yearInput],t._focusEvents={focus:l(V,t),blur:l(P,t)}),t.moveTo(t.date,!1),t.setTime(null,!0),n.topCont}function O(t){function e(){a.showTime&&(n.push("<td>"),function(t,e){e.push("<table class='DynarchCalendar-time'"+nt+"><tr>","<td rowspan='2'><div dyc-type='time-hour' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-hour'></div></td>","<td dyc-type='time-hour+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>","<td rowspan='2' class='DynarchCalendar-time-sep'></td>","<td rowspan='2'><div dyc-type='time-min' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-minute'></div></td>","<td dyc-type='time-min+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>"),12==t.args.showTime&&e.push("<td rowspan='2' class='DynarchCalendar-time-sep'></td>","<td rowspan='2'><div class='DynarchCalendar-time-am' dyc-type='time-am' dyc-cls='hover-time,pressed-time'></div></td>"),e.push("</tr><tr>","<td dyc-type='time-hour-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td>","<td dyc-type='time-min-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td>","</tr></table>")}(t,n),n.push("</td>"))}var n=[],a=t.args;return n.push("<table",nt," style='width:100%'><tr>"),"left"==a.timePos&&e(),a.bottomBar&&(n.push("<td>"),n.push("<table",nt,"><tr><td>","<div dyc-btn='today' dyc-cls='hover-bottomBar-today,pressed-bottomBar-today' dyc-type='bottomBar-today' ","class='DynarchCalendar-bottomBar-today'>",T("today"),"</div>","</td></tr></table>"),n.push("</td>")),"right"==a.timePos&&e(),n.push("</tr></table>"),n.join("")}function W(t){for(var e,n=["<table height='100%'",nt,"><tr><td>","<table style='margin-top: 1.5em'",nt,">","<tr><td colspan='3'><input dyc-btn='year' class='DynarchCalendar-menu-year' size='6' value='",t.date.getFullYear(),"' /></td></tr>","<tr><td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='today'>",T("goToday"),"</div></td></tr>","</table>","<p class='DynarchCalendar-menu-sep'>&nbsp;</p>","<table class='DynarchCalendar-menu-mtable'",nt,">"],a=T("smn"),s=0,i=n.length;s<12;){for(n[i++]="<tr>",e=4;--e>0;)n[i++]="<td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='m"+s+"' class='DynarchCalendar-menu-month'>"+a[s++]+"</div></td>";n[i++]="</tr>"}return n[i++]="</table></td></tr></table>",n.join("")}function K(t){return"<div unselectable='on'>"+b(t.date,t.args.titleFormat)+"</div>"}function $(t,e,n){e=e||t.date,n=n||t.fdow;var a=(e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0,0)).getMonth(),s=[],i=0,r=t.args.weekNumbers;e.setDate(1);var o=(e.getDay()-n)%7;o<0&&(o+=7),e.setDate(0-o),e.setDate(e.getDate()+1);var l=new Date,c=l.getDate(),h=l.getMonth(),u=l.getFullYear();s[i++]="<table class='DynarchCalendar-bodyTable'"+nt+">";for(var d=0;d<6;++d){s[i++]="<tr class='DynarchCalendar-week",0==d&&(s[i++]=" DynarchCalendar-first-row"),5==d&&(s[i++]=" DynarchCalendar-last-row"),s[i++]="'>",r&&(s[i++]="<td class='DynarchCalendar-first-col'><div class='DynarchCalendar-weekNumber'>"+_(e)+"</div></td>");for(var f=0;f<7;++f){var y=e.getDate(),p=e.getMonth(),m=e.getFullYear(),v=1e4*m+100*(p+1)+y,g=t.selection.isSelected(v),D=t.isDisabled(e);s[i++]="<td class='",0==f&&!r&&(s[i++]=" DynarchCalendar-first-col"),0==f&&0==d&&(t._firstDateVisible=v),6==f&&(s[i++]=" DynarchCalendar-last-col",5==d&&(t._lastDateVisible=v)),g&&(s[i++]=" DynarchCalendar-td-selected"),s[i++]="'><div dyc-type='date' unselectable='on' dyc-date='"+v+"' ",D&&(s[i++]="disabled='1' "),s[i++]="class='DynarchCalendar-day",T("weekend").indexOf(e.getDay())>=0&&(s[i++]=" DynarchCalendar-weekend"),p!=a&&(s[i++]=" DynarchCalendar-day-othermonth"),y==c&&p==h&&m==u&&(s[i++]=" DynarchCalendar-day-today"),D&&(s[i++]=" DynarchCalendar-day-disabled"),g&&(s[i++]=" DynarchCalendar-day-selected"),(D=t.args.dateInfo(e))&&D.klass&&(s[i++]=" "+D.klass),s[i++]="'>"+y+"</div></td>",e=new Date(m,p,y+1,12,0,0,0)}s[i++]="</tr>"}return s[i++]="</table>",s.join("")}function j(t){var e=["<table",nt,"><tr>"],n=0;for(t.args.weekNumbers&&e.push("<td><div class='DynarchCalendar-weekNumber'>",T("wk"),"</div></td>");n<7;){var a=(n+++t.fdow)%7;e.push("<td><div",T("weekend").indexOf(a)>=0?" class='DynarchCalendar-weekend'>":">",T("sdn")[a],"</div></td>")}return e.push("</tr></table>"),e.join("")}function z(n){n=n||{},this.args=n=v(n,{animation:!Q,cont:null,bottomBar:!0,date:!0,fdow:T("fdow"),min:null,max:null,reverseWheel:!1,selection:[],selectionType:z.SEL_SINGLE,weekNumbers:!1,align:"Bl/ / /T/r",inputField:null,trigger:null,dateFormat:"%Y-%m-%d",fixed:!1,opacity:J?1:3,titleFormat:"%b %Y",showTime:!1,timePos:"right",time:!0,minuteStep:5,noScroll:!1,disabled:lt,checkRange:!1,dateInfo:lt,onChange:lt,onSelect:lt,onTimeChange:lt,onFocus:lt,onBlur:lt}),this.handlers={};var a=this,s=new Date;n.min=D(n.min),n.max=D(n.max),!0===n.date&&(n.date=s),!0===n.time&&(n.time=100*s.getHours()+Math.floor(s.getMinutes()/n.minuteStep)*n.minuteStep),this.date=D(n.date),this.time=n.time,this.fdow=n.fdow,e("onChange onSelect onTimeChange onFocus onBlur".split(/\s+/),(function(t){var e=n[t];e instanceof Array||(e=[e]),a.handlers[t]=e})),this.selection=new z.Selection(n.selection,n.selectionType,A,this);var i=U(this);n.cont&&t(n.cont).appendChild(i),n.trigger&&this.manageFields(n.trigger,n.inputField,n.dateFormat)}var G=navigator.userAgent,X=/opera/i.test(G),q=/Konqueror|Safari|KHTML/i.test(G),J=/msie/i.test(G)&&!X&&!/mac_powerpc/i.test(G),Q=J&&/msie 6/i.test(G),Z=/gecko/i.test(G)&&!q&&!X&&!J,tt=z.prototype,et=z.I18N={};z.SEL_NONE=0,z.SEL_SINGLE=1,z.SEL_MULTIPLE=2,z.SEL_WEEK=3,z.dateToInt=M,z.intToDate=w,z.printDate=b,z.formatString=x,z.i18n=T,z.LANG=function(t,e,n){et.__=et[t]={name:e,data:n}},z.setup=function(t){return new z(t)},tt.moveTo=function(t,e){var n,a=this,s=C(t=D(t),a.date,!0),o=a.args,l=o.min&&C(t,o.min),c=o.max&&C(t,o.max);if(o.animation||(e=!1),u(null!=l&&l<=1,[a.els.navPrevMonth,a.els.navPrevYear],"DynarchCalendar-navDisabled"),u(null!=c&&c>=-1,[a.els.navNextMonth,a.els.navNextYear],"DynarchCalendar-navDisabled"),l<-1&&(t=o.min,n=1,s=0),c>1&&(t=o.max,n=2,s=0),a.date=t,a.refresh(!!e),a.callHooks("onChange",a,t,e),e&&(0!=s||2!=e)){a._bodyAnim&&a._bodyAnim.stop();var d=a.els.body,f=h("div","DynarchCalendar-animBody-"+st[s],d),y=d.firstChild,p=(i(y),n?ot.brakes:0==s?ot.shake:ot.accel_ab2),m=s*s>4,v=m?y.offsetTop:y.offsetLeft,g=f.style,b=m?d.offsetHeight:d.offsetWidth;if(s<0?b+=v:s>0?b=v-b:(b=Math.round(b/7),2==n&&(b=-b)),!n&&0!=s){var w=f.cloneNode(!0),M=w.style,_=2*b;w.appendChild(y.cloneNode(!0)),M[m?"marginTop":"marginLeft"]=b+"px",d.appendChild(w)}y.style.visibility="hidden",f.innerHTML=$(a),a._bodyAnim=r({onUpdate:function(t,e){var r=p(t);if(w)var o=e(r,b,_)+"px";n?g[m?"marginTop":"marginLeft"]=e(r,b,0)+"px":((m||0==s)&&(g.marginTop=e(0==s?p(t*t):r,0,b)+"px",0!=s&&(M.marginTop=o)),m&&0!=s||(g.marginLeft=e(r,0,b)+"px",0!=s&&(M.marginLeft=o))),a.args.opacity>2&&w&&(i(w,1-r),i(f,r))},onStop:function(e){d.innerHTML=$(a,t),a._bodyAnim=null}})}return a._lastHoverDate=null,l>=-1&&c<=1},tt.isDisabled=function(t){var e=this.args;return e.min&&C(t,e.min)<0||e.max&&C(t,e.max)>0||e.disabled(t)},tt.toggleMenu=function(){N(this,!this._menuVisible)},tt.refresh=function(t){var e=this.els;t||(e.body.innerHTML=$(this)),e.title.innerHTML=K(this),e.yearInput.value=this.date.getFullYear()},tt.redraw=function(){var t=this,e=t.els;t.refresh(),e.dayNames.innerHTML=j(t),e.menu.innerHTML=W(t),e.bottomBar&&(e.bottomBar.innerHTML=O(t)),o(e.topCont,(function(n){var a=at[n.className];a&&(e[a]=n),"DynarchCalendar-menu-year"==n.className?(m(n,t._focusEvents),e.yearInput=n):J&&n.setAttribute("unselectable","on")})),t.setTime(null,!0)},tt.setLanguage=function(t){var e=z.setLanguage(t);e&&(this.fdow=e.data.fdow,this.redraw())},z.setLanguage=function(t){var e=et[t];return e&&(et.__=e),e},tt.focus=function(){try{this.els[this._menuVisible?"yearInput":"focusLink"].focus()}catch(t){}V.call(this)},tt.blur=function(){this.els.focusLink.blur(),this.els.yearInput.blur(),R.call(this)},tt.showAt=function(t,e,n){this._showAnim&&this._showAnim.stop(),n=n&&this.args.animation;var a=this.els.topCont,s=this,o=this.els.body.firstChild,l=o.offsetHeight,c=a.style;c.position="absolute",c.left=t+"px",c.top=e+"px",c.zIndex=1e4,c.display="",n&&(o.style.marginTop=-l+"px",this.args.opacity>1&&i(a,0),this._showAnim=r({onUpdate:function(t,e){o.style.marginTop=-e(ot.accel_b(t),l,0)+"px",s.args.opacity>1&&i(a,t)},onStop:function(){s.args.opacity>1&&i(a,""),s._showAnim=null}}))},tt.hide=function(){var t=this.els.topCont,e=this,a=this.els.body.firstChild,s=a.offsetHeight,o=n(t).y;this.args.animation?(this._showAnim&&this._showAnim.stop(),this._showAnim=r({onUpdate:function(n,r){e.args.opacity>1&&i(t,1-n),a.style.marginTop=-r(ot.accel_b(n),0,s)+"px",t.style.top=r(ot.accel_ab(n),o,o-10)+"px"},onStop:function(){t.style.display="none",a.style.marginTop="",e.args.opacity>1&&i(t,""),e._showAnim=null}})):t.style.display="none",this.inputField=null},tt.popup=function(e,a){function s(t){var n={x:h.x,y:h.y};return t?(/B/.test(t)&&(n.y+=e.offsetHeight),/b/.test(t)&&(n.y+=e.offsetHeight-i.y),/T/.test(t)&&(n.y-=i.y),/l/.test(t)&&(n.x-=i.x-e.offsetWidth),/L/.test(t)&&(n.x-=i.x),/R/.test(t)&&(n.x+=e.offsetWidth),/c/i.test(t)&&(n.x+=(e.offsetWidth-i.x)/2),/m/i.test(t)&&(n.y+=(e.offsetHeight-i.y)/2),n):n}e=t(e),a||(a=this.args.align),a=a.split(/\x2f/);var i,r=n(e),o=this.els.topCont,l=o.style,c=function(){var t=document.documentElement,e=document.body;return{x:t.scrollLeft||e.scrollLeft,y:t.scrollTop||e.scrollTop,w:t.clientWidth||window.innerWidth||e.clientWidth,h:t.clientHeight||window.innerHeight||e.clientHeight}}();l.visibility="hidden",l.display="",this.showAt(0,0),document.body.appendChild(o),i={x:o.offsetWidth,y:o.offsetHeight};var h=r;(h=s(a[0])).y<c.y&&(h.y=r.y,h=s(a[1])),h.x+i.x>c.x+c.w&&(h.x=r.x,h=s(a[2])),h.y+i.y>c.y+c.h&&(h.y=r.y,h=s(a[3])),h.x<c.x&&(h.x=r.x,h=s(a[4])),this.showAt(h.x,h.y,!0),l.visibility="",this.focus()},tt.manageFields=function(e,n,a){var s=this;n=t(n),e=t(e),/^button$/i.test(e.tagName)&&e.setAttribute("type","button"),m(e,"click",(function(){var t,i,r,o;(s.inputField=n,s.dateFormat=a,s.selection.type==z.SEL_SINGLE)&&((t=/input|textarea/i.test(n.tagName)?n.value:n.innerText||n.textContent)&&(i=/(^|[^%])%[bBmo]/.exec(a),r=/(^|[^%])%[de]/.exec(a),i&&r&&(o=i.index<r.index),(t=Calendar.parseDate(t,o))&&(s.selection.set(t,!1,!0),s.args.showTime&&(s.setHours(t.getHours()),s.setMinutes(t.getMinutes())),s.moveTo(t))));s.popup(e)}))},tt.callHooks=function(t){for(var e=c(arguments,1),n=this.handlers[t],a=0;a<n.length;++a)n[a].apply(this,e)},tt.addEventListener=function(t,e){this.handlers[t].push(e)},tt.removeEventListener=function(t,e){for(var n=this.handlers[t],a=n.length;--a>=0;)n[a]===e&&n.splice(a,1)},tt.getTime=function(){return this.time},tt.setTime=function(t,e){if(this.args.showTime){t=null!=t?t:this.time,this.time=t;var n=this.getHours(),a=this.getMinutes(),s=n<12;12==this.args.showTime&&(0==n&&(n=12),n>12&&(n-=12),this.els.timeAM.innerHTML=T(s?"AM":"PM")),n<10&&(n="0"+n),a<10&&(a="0"+a),this.els.timeHour.innerHTML=n,this.els.timeMinute.innerHTML=a,e||this.callHooks("onTimeChange",this,t)}},tt.getHours=function(){return Math.floor(this.time/100)},tt.getMinutes=function(){return this.time%100},tt.setHours=function(t){t<0&&(t+=24),this.setTime(t%24*100+this.time%100)},tt.setMinutes=function(t){t<0&&(t+=60),t=Math.floor(t/this.args.minuteStep)*this.args.minuteStep,this.setTime(100*this.getHours()+t%60)},tt._getInputYear=function(){var t=parseInt(this.els.yearInput.value,10);return isNaN(t)&&(t=this.date.getFullYear()),t},tt._showTooltip=function(t){var e,n="",a=this.els.tooltip;t&&(t=w(t),(e=this.args.dateInfo(t))&&e.tooltip&&(n="<div class='DynarchCalendar-tooltipCont'>"+b(t,e.tooltip)+"</div>")),a.innerHTML=n};var nt=" align='center' cellspacing='0' cellpadding='0'",at={"DynarchCalendar-topCont":"topCont","DynarchCalendar-focusLink":"focusLink",DynarchCalendar:"main","DynarchCalendar-topBar":"topBar","DynarchCalendar-title":"title","DynarchCalendar-dayNames":"dayNames","DynarchCalendar-body":"body","DynarchCalendar-menu":"menu","DynarchCalendar-menu-year":"yearInput","DynarchCalendar-bottomBar":"bottomBar","DynarchCalendar-tooltip":"tooltip","DynarchCalendar-time-hour":"timeHour","DynarchCalendar-time-minute":"timeMinute","DynarchCalendar-time-am":"timeAM","DynarchCalendar-navBtn DynarchCalendar-prevYear":"navPrevYear","DynarchCalendar-navBtn DynarchCalendar-nextYear":"navNextYear","DynarchCalendar-navBtn DynarchCalendar-prevMonth":"navPrevMonth","DynarchCalendar-navBtn DynarchCalendar-nextMonth":"navNextMonth"},st={"-3":"backYear","-2":"back",0:"now",2:"fwd",3:"fwdYear"},it={37:-1,38:-2,39:1,40:2},rt={33:-1,34:1};tt._getDateDiv=function(t){var e=null;if(t)try{o(this.els.body,(function(n){if(n.getAttribute("dyc-date")==t)throw e=n}))}catch(t){}return e},(z.Selection=function(t,e,n,a){this.type=e,this.sel=t instanceof Array?t:[t],this.onChange=l(n,a),this.cal=a}).prototype={get:function(){return this.type==z.SEL_SINGLE?this.sel[0]:this.sel},isEmpty:function(){return 0==this.sel.length},set:function(t,e,n){var a=this.type==z.SEL_SINGLE;t instanceof Array?(this.sel=t,this.normalize(),n||this.onChange(this)):(t=M(t),a||!this.isSelected(t)?(a?this.sel=[t]:this.sel.splice(this.findInsertPos(t),0,t),this.normalize(),n||this.onChange(this)):e&&this.unselect(t,n))},reset:function(){this.sel=[],this.set.apply(this,arguments)},countDays:function(){for(var t,e,n,a=0,s=this.sel,i=s.length;--i>=0;)(t=s[i])instanceof Array&&(e=w(t[0]),n=w(t[1]),a+=Math.round(Math.abs(n.getTime()-e.getTime())/864e5)),++a;return a},unselect:function(t,e){t=M(t);for(var n,a=!1,s=this.sel,i=s.length;--i>=0;)if((n=s[i])instanceof Array){if(t>=n[0]&&t<=n[1]){var r=w(t),o=r.getDate();if(t==n[0])r.setDate(o+1),n[0]=M(r),a=!0;else if(t==n[1])r.setDate(o-1),n[1]=M(r),a=!0;else{var l=new Date(r);l.setDate(o+1),r.setDate(o-1),s.splice(i+1,0,[M(l),n[1]]),n[1]=M(r),a=!0}}}else t==n&&(s.splice(i,1),a=!0);a&&(this.normalize(),e||this.onChange(this))},normalize:function(){this.sel=this.sel.sort((function(t,e){return t instanceof Array&&(t=t[0]),e instanceof Array&&(e=e[0]),t-e}));for(var t,e,n=this.sel,a=n.length;--a>=0;){if((t=n[a])instanceof Array){if(t[0]>t[1]){n.splice(a,1);continue}t[0]==t[1]&&(t=n[a]=t[0])}if(e){var s=e,i=t instanceof Array?t[1]:t;if((i=w(i)).setDate(i.getDate()+1),(i=M(i))>=s){var r=n[a+1];t instanceof Array&&r instanceof Array?(t[1]=r[1],n.splice(a+1,1)):t instanceof Array?(t[1]=e,n.splice(a+1,1)):r instanceof Array?(r[0]=t,n.splice(a,1)):(n[a]=[t,r],n.splice(a+1,1))}}e=t instanceof Array?t[0]:t}},findInsertPos:function(t){for(var e,n=this.sel,a=n.length;--a>=0&&((e=n[a])instanceof Array&&(e=e[0]),!(e<=t)););return a+1},clear:function(t){this.sel=[],t||this.onChange(this)},selectRange:function(t,n){if((t=M(t))>(n=M(n))){var a=t;t=n,n=a}var s=this.cal.args.checkRange;if(!s)return this._do_selectRange(t,n);try{e(new z.Selection([[t,n]],z.SEL_MULTIPLE,lt).getDates(),l((function(t){if(this.isDisabled(t))throw s instanceof Function&&s(t,this),"OUT"}),this.cal)),this._do_selectRange(t,n)}catch(t){}},_do_selectRange:function(t,e){this.sel.push([t,e]),this.normalize(),this.onChange(this)},isSelected:function(t){for(var e,n=this.sel.length;--n>=0;)if((e=this.sel[n])instanceof Array&&t>=e[0]&&t<=e[1]||t==e)return!0;return!1},getFirstDate:function(){var t=this.sel[0];return t&&t instanceof Array&&(t=t[0]),t},getLastDate:function(){if(this.sel.length>0){var t=this.sel[this.sel.length-1];return t&&t instanceof Array&&(t=t[1]),t}},print:function(t,e){var n,a=[],s=0,i=this.cal.getHours(),r=this.cal.getMinutes();for(e||(e=" -> ");s<this.sel.length;)(n=this.sel[s++])instanceof Array?a.push(b(w(n[0],i,r),t)+e+b(w(n[1],i,r),t)):a.push(b(w(n,i,r),t));return a},getDates:function(t){for(var e,n,a=[],s=0;s<this.sel.length;){if((n=this.sel[s++])instanceof Array)for(e=w(n[0]),n=n[1];M(e)<n;)a.push(t?b(e,t):new Date(e)),e.setDate(e.getDate()+1);else e=w(n);a.push(t?b(e,t):e)}return a}},z.isUnicodeLetter=function(t){return t.toUpperCase()!=t.toLowerCase()},z.parseDate=function(t,e,n){if(!/\S/.test(t))return"";t=t.replace(/^\s+/,"").replace(/\s+$/,""),n=n||new Date;var a=null,s=null,i=null,r=null,o=null,l=null,c=t.match(/([0-9]{1,2}):([0-9]{1,2})(:[0-9]{1,2})?\s*(am|pm)?/i);c&&(r=parseInt(c[1],10),o=parseInt(c[2],10),l=c[3]?parseInt(c[3].substr(1),10):0,t=t.substring(0,c.index)+t.substr(c.index+c[0].length),c[4]&&("pm"==c[4].toLowerCase()&&r<12?r+=12:"am"==c[4].toLowerCase()&&r>=12&&(r-=12)));for(var h=function(){function e(t){l.push(t)}function n(){for(var t="";s()&&/[0-9]/.test(s());)t+=i();return c(s())?a(t):parseInt(t,10)}function a(t){for(;s()&&c(s());)t+=i();return t}function s(){return t.charAt(o)}function i(){return t.charAt(o++)}for(var r,o=0,l=[],c=z.isUnicodeLetter;o<t.length;)r=s(),c(r)?e(a("")):/[0-9]/.test(r)?e(n()):i();return l}(),u=[],d=0;d<h.length;++d){var f=h[d];/^[0-9]{4}$/.test(f)?(a=parseInt(f,10),null==s&&null==i&&null==e&&(e=!0)):/^[0-9]{1,2}$/.test(f)?(f=parseInt(f,10))<60?f<0||f>12?f>=1&&f<=31&&(i=f):u.push(f):a=f:null==s&&(s=g(f))}return u.length<2?1==u.length&&(null==i?i=u.shift():null==s&&(s=u.shift())):e?(null==s&&(s=u.shift()),null==i&&(i=u.shift())):(null==i&&(i=u.shift()),null==s&&(s=u.shift())),null==a&&(a=u.length>0?u.shift():n.getFullYear()),a<30?a+=2e3:a<99&&(a+=1900),null==s&&(s=n.getMonth()+1),null!=a&&null!=s&&null!=i?new Date(a,s-1,i,r,o,l):null};var ot={elastic_b:function(t){return 1-Math.cos(5.5*-t*Math.PI)/Math.pow(2,7*t)},magnetic:function(t){return 1-Math.cos(t*t*t*10.5*Math.PI)/Math.exp(4*t)},accel_b:function(t){return 1-(t=1-t)*t*t*t},accel_a:function(t){return t*t*t},accel_ab:function(t){return t=1-t,1-Math.sin(t*t*Math.PI/2)},accel_ab2:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},brakes:function(t){return t=1-t,1-Math.sin(t*t*Math.PI)},shake:function(t){return t<.5?-Math.cos(11*t*Math.PI)*t*t:(t=1-t,Math.cos(11*t*Math.PI)*t*t)}},lt=new Function;return z}();